<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Interactive 3D family tree visualizer for CryptoKitties. Explore breeding relationships in three dimensions." />

  <!-- Open Graph -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="CryptoKitties Family Graph - 3D View" />
  <meta property="og:description" content="Interactive 3D family tree visualizer for CryptoKitties." />
  <meta property="og:image" content="https://ck.innerlogics.com/images/og-image.png" />
  <meta property="og:url" content="https://ck.innerlogics.com/3d.html" />

  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32.png">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
  <title>CryptoKitties Family Graph - 3D</title>

  <link rel="stylesheet" href="./css/ck-family-graph-base.css">
  <link rel="stylesheet" href="./css/ck-family-graph-3d.css">

  <script>
    window.CK_GRAPH_DEFAULTS = {
      debugLevel: 2,
      useProxy: false,
      proxyUrl: "",
      svgBaseUrl: "https://www.cryptokitties.co",
      githubUrl: "https://github.com/nivs/crypto-kitties-family-graph"
    };
  </script>
</head>

<body>
  <header>
    <div class="title"><a href="./index.html">CryptoKitties Family Graph</a> - 3D</div>
    <div class="controls">
      <div class="input-with-btn">
        <input id="jsonUrl" class="input-in-group" placeholder="JSON URL or drag file" />
        <button class="btn-in-input" id="loadJsonBtn" title="Load from URL or select file">Load</button>
      </div>
      <input type="file" id="jsonFilePicker" accept=".json,application/json" class="hidden-input" />
      <div class="input-with-btn">
        <input id="kittyIdInput" class="input-in-group-wide" placeholder="Kitty ID(s)" />
        <button class="btn-in-input-left" id="addKittyBtn" title="Add kitties to existing graph">Add</button>
        <button class="btn-in-input" id="loadKittyBtn" title="Load kitties (replaces graph)">Load</button>
      </div>
      <button class="btn" id="permalinkBtn" title="Copy permalink to clipboard">Permalink</button>
      <button class="btn" id="embedBtn" title="Generate embed code">Embed</button>
      <button class="btn" id="view2dBtn" title="Switch to 2D view">2D</button>
      <span class="pill" id="statsPill">No data loaded</span>
    </div>
  </header>

  <div id="graph-container"></div>
  <div id="banner"></div>
  <a href="https://www.innerlogics.com" target="_blank" rel="noopener" class="floating-logo" title="innerlogics.com">
    <img src="./images/innerlogics-logo.png" alt="innerlogics" />
  </a>
  <div id="tooltip" class="tooltip"></div>

  <!-- Context menu -->
  <div id="contextMenu" class="context-menu">
    <div class="context-menu-item" data-action="center">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>
      Center on this kitty
    </div>
    <div class="context-menu-item" data-action="expand">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
      Expand family
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" data-action="highlightOwner">
      <span class="menu-icon"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg></span>
      <span class="menu-text">Highlight owner</span>
    </div>
    <div class="context-menu-item" data-action="openOwner">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
      Open owner page
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" data-action="copyId">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"/><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/></svg>
      Copy kitty ID
    </div>
    <div class="context-menu-item" data-action="openCK">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
      Open kitty page
    </div>
  </div>

  <!-- Floating panel for embed mode (accordion style) -->
  <div class="floating-panel" id="floatingPanel">
    <div class="floating-panel-header" id="floatingPanelDragHandle">
      <span class="panel-title">CryptoKitties</span>
      <button class="panel-btn switcher-btn" id="floatingView2dBtn" title="Switch to 2D view">2D</button>
      <button class="panel-btn" id="floatingPanelCollapse" title="Collapse panel">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="18 15 12 9 6 15"></polyline></svg>
      </button>
      <button class="panel-btn" id="floatingPanelClose" title="Close">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
      </button>
    </div>
    <div class="floating-panel-body" id="floatingPanelBody">
      <!-- Accordion: Selected Kitty -->
      <div class="accordion-section">
        <div class="accordion-header" id="floatingSelectedToggle">
          <span class="accordion-title">Selected Kitty</span>
          <svg class="accordion-chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
        </div>
        <div class="accordion-body" id="floatingSelectedBody">
          <div id="floatingSelectedBox" class="small">Click a kitty to select</div>
        </div>
      </div>
      <!-- Accordion: Filters -->
      <div class="accordion-section collapsed">
        <div class="accordion-header" id="floatingFiltersToggle">
          <span class="accordion-title">Filters</span>
          <svg class="accordion-chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
        </div>
        <div class="accordion-body" id="floatingFiltersBody">
          <div class="filter-controls">
            <div class="filter-row">
              <label class="filter-label">Generation Range</label>
              <div class="filter-range">
                <input type="number" id="floatingGenerationMin" class="filter-input" placeholder="Min" min="0" />
                <span class="filter-range-sep">–</span>
                <input type="number" id="floatingGenerationMax" class="filter-input" placeholder="Max" min="0" />
              </div>
            </div>
            <div class="filter-row">
              <label class="filter-label">Mewtations</label>
              <div class="filter-buttons">
                <button class="filter-btn" id="floatingMewtationFilterAll" title="All mewtations">All</button>
                <button class="filter-btn gem-diamond" id="floatingMewtationFilterDiamond" title="Diamond (1st discovery)">
                  <img src="./images/cattributes/mewtation-gems/diamond.svg" alt="Diamond" class="gem-filter-icon" />
                </button>
                <button class="filter-btn gem-gold" id="floatingMewtationFilterGold" title="Gilded (2-10)">
                  <img src="./images/cattributes/mewtation-gems/gold.svg" alt="Gold" class="gem-filter-icon" />
                </button>
                <button class="filter-btn gem-silver" id="floatingMewtationFilterSilver" title="Amethyst (11-100)">
                  <img src="./images/cattributes/mewtation-gems/silver.svg" alt="Silver" class="gem-filter-icon" />
                </button>
                <button class="filter-btn gem-bronze" id="floatingMewtationFilterBronze" title="Lapis (101-500)">
                  <img src="./images/cattributes/mewtation-gems/bronze.svg" alt="Bronze" class="gem-filter-icon" />
                </button>
              </div>
            </div>
            <div class="filter-row filter-row-inline">
              <label class="filter-checkbox-label">
                <input type="checkbox" id="floatingFilterEdgeHighlight" />
                <span>Highlight edges between filtered kitties</span>
              </label>
            </div>
            <div class="filter-row filter-row-inline">
              <label class="filter-checkbox-label" title="Hover to highlight path from selected">
                <input type="checkbox" id="floatingShortestPathMode" />
                <span>Highlight shortest path</span>
              </label>
            </div>
            <button class="btn btn-small" id="floatingClearFiltersBtn">Clear Filters</button>
          </div>
        </div>
      </div>
      <!-- Accordion: Layout (3D only) -->
      <div class="accordion-section collapsed">
        <div class="accordion-header" id="floatingZAxisToggle">
          <span class="accordion-title">Layout</span>
          <svg class="accordion-chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
        </div>
        <div class="accordion-body" id="floatingZAxisBody">
          <select id="floatingZAxisSelect" class="input input-full">
            <option value="generation">Generation (older = higher)</option>
            <option value="birthday">Birthday (older = higher)</option>
            <option value="rarity">Rarity (rarer = higher)</option>
            <option value="flat">Flat (no Z variance)</option>
          </select>
        </div>
      </div>
      <!-- Accordion: Settings (non-embed only) -->
      <div class="accordion-section accordion-section-settings collapsed">
        <div class="accordion-header" id="floatingSettingsToggle">
          <span class="accordion-title">Settings</span>
          <svg class="accordion-chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
        </div>
        <div class="accordion-body" id="floatingSettingsBody">
          <div class="filter-controls">
            <div class="filter-row filter-row-inline">
              <label class="filter-checkbox-label">
                <input type="checkbox" id="floatingPrefetchChildren" checked />
                <span>Pre-fetch children</span>
              </label>
            </div>
            <div class="filter-row filter-row-inline">
              <label class="filter-checkbox-label">
                <input type="checkbox" id="floatingAutoConnect" checked />
                <span>Auto-connect</span>
              </label>
            </div>
          </div>
        </div>
      </div>
      <!-- Accordion: Examples (non-embed only) -->
      <div class="accordion-section accordion-section-examples collapsed">
        <div class="accordion-header" id="floatingExamplesToggle">
          <span class="accordion-title">Examples</span>
          <svg class="accordion-chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="6 9 12 15 18 9"></polyline></svg>
        </div>
        <div class="accordion-body" id="floatingExamplesBody">
          <div class="examples-list">
            <a href="3d.html?dataUrl=./examples/dragon/dragon_extended.json&selected=896775&zAxis=rarity&cam3d=-208.3_480.1_58.1_-0.0975_0.6487_0.7490_-0.0930_1.00&examples=open" class="example-link">Dragon</a>
            <span class="example-desc">600 ETH (~$170k)</span>

            <a href="3d.html?dataUrl=./examples/founders/founders_children.json&genMax=0&zAxis=rarity&cam2d=0.692_-6.6_-35.8&cam3d=13.4_538.8_70.3_-0.0975_0.6487_0.7490_-0.0930_1.00&examples=open" class="example-link">Founders</a>
            <span class="example-desc">Founder Core Set</span>

            <a href="3d.html?dataUrl=./examples/milestones/milestones.json&zAxis=rarity&cam2d=1.195_28.9_-181.5&cam3d=28.9_285.2_44.9_-0.0975_0.6487_0.7490_-0.0930_1.00&examples=open" class="example-link">Milestones</a>
            <span class="example-desc">100k & 500k</span>

            <a href="3d.html?dataUrl=./examples/holidays/holidays.json&zAxis=rarity&cam2d=1.887_37.9_-186.4&cam3d=37.9_208.9_33.3_-0.0975_0.6487_0.7490_-0.0930_1.00&examples=open" class="example-link">Holidays</a>
            <span class="example-desc">Mistletoe & SantaClaws</span>

            <a href="3d.html?dataUrl=./examples/fancies/fancies.json&zAxis=generation&cam2d=0.657_17.1_-66.1&cam3d=17.1_305.4_23.8_-0.0975_0.6487_0.7490_-0.0930_1.00&examples=open" class="example-link">Fancies</a>
            <span class="example-desc">42 bred fancies</span>

            <a href="3d.html?dataUrl=./examples/purrstiges/purrstiges.json&zAxis=generation&cam2d=0.864_12.7_-41.4&cam3d=12.7_259.1_34.5_-0.0975_0.6487_0.7490_-0.0930_1.00&examples=open" class="example-link">Purrstiges</a>
            <span class="example-desc">59 time-limited</span>

            <a href="3d.html?dataUrl=./examples/exclusives/exclusives.json&zAxis=generation&cam2d=0.100_0.6_-1.8&cam3d=0.6_213301.2_57.2_-0.0975_0.6487_0.7490_-0.0930_1.00&examples=open" class="example-link">Exclusives</a>
            <span class="example-desc">317 celebrity cats</span>

            <a href="3d.html?dataUrl=./examples/tier_iii/tier_iii.json&mewtations=diamond,gold&filterEdgeHighlight=true&zAxis=rarity&cam2d=0.314_-6.8_-1.5&cam3d=-6.8_612.5_52.1_-0.0975_0.6487_0.7490_-0.0930_1.00&examples=open" class="example-link">Tier III</a>
            <span class="example-desc">Very rare mewtations</span>

            <a href="3d.html?dataUrl=./examples/tier_iiii/tier_iiii.json&mewtations=diamond&filterEdgeHighlight=true&zAxis=rarity&cam2d=0.250_-1.6_-4.2&cam3d=-1.6_1104.2_60.7_-0.0975_0.6487_0.7490_-0.0930_1.00&examples=open" class="example-link">Tier IIII</a>
            <span class="example-desc">Rarest mewtations</span>

            <a href="3d.html?dataUrl=./examples/diamonds/diamonds.json&mewtations=all&filterEdgeHighlight=true&zAxis=rarity&cam2d=0.100_-7.8_-5.9&cam3d=-7.8_5385.6_58.7_-0.0975_0.6487_0.7490_-0.0930_1.00&examples=open" class="example-link">Diamonds</a>
            <span class="example-desc">First discoverers</span>

            <a href="3d.html?dataUrl=./examples/gen0_diamonds/gen0_diamonds.json&mewtations=diamond&filterEdgeHighlight=true&zAxis=rarity&cam2d=0.518_14.3_-73.5&cam3d=14.3_297.2_48.1_-0.0975_0.6487_0.7490_-0.0930_1.00&examples=open" class="example-link">Gen-0 Diamonds</a>
            <span class="example-desc">40 trait discoverers</span>

            <a href="3d.html?dataUrl=./examples/shortest_path/holiday_fancies.json&pathFrom=174756&pathTo=275808&zAxis=rarity&cam2d=0.100_1.5_-4.6&cam3d=1.5_6845.3_63.2_-0.0975_0.6487_0.7490_-0.0930_1.00&examples=open" class="example-link">Holiday Fancies Path</a>
            <span class="example-desc">Mistletoe → Santa</span>

            <a href="3d.html?dataUrl=./examples/dragon/dragon_connected.json&selected=896775&shortestPath=true&zAxis=rarity&cam3d=6.6_311.1_45.0_-0.0975_0.6487_0.7490_-0.0930_1.00&examples=open" class="example-link">Dragon Path</a>
            <span class="example-desc">Hover for paths</span>
          </div>
        </div>
      </div>
    </div>
    <div class="floating-panel-footer">
      <a href="#" id="floatingGithubLink" target="_blank" rel="noopener">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>
        GitHub
      </a>
      <button type="button" id="floatingViewerLink" class="link-btn">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line></svg>
        Open in viewer
      </button>
    </div>
  </div>

  <!-- Embed Code Modal -->
  <div id="embedModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Embed Code</h3>
        <button class="modal-close" id="embedModalClose">×</button>
      </div>
      <div class="modal-body">
        <div class="embed-options">
          <div class="embed-option-row">
            <label>Viewer:</label>
            <select id="embedViewer" class="embed-select">
              <option value="2d">2D</option>
              <option value="3d" selected>3D</option>
            </select>
            <label class="ml-3">
              <input type="checkbox" id="embedSwitcher" checked />
              2D/3D switcher
            </label>
            <label class="ml-3">
              <input type="checkbox" id="embedViewport" />
              Save viewport
            </label>
            <label class="ml-3">
              <input type="checkbox" id="embedActivate" />
              Click to activate
            </label>
          </div>
          <div class="embed-option-row">
            <label>Width:</label>
            <input type="text" id="embedWidth" class="embed-input embed-input-sm" value="" placeholder="800" />
            <label class="ml-3">Height:</label>
            <input type="text" id="embedHeight" class="embed-input embed-input-sm" value="" placeholder="600" />
          </div>
        </div>
        <div class="embed-code-wrapper">
          <textarea id="embedCodeOutput" class="embed-code" readonly></textarea>
        </div>
        <button class="btn primary" id="embedCopyBtn">Copy to Clipboard</button>
      </div>
    </div>
  </div>

  <script src="./js/ck-family-graph-base.js"></script>
  <script type="module" src="./js/ck-family-graph-3d.js"></script>
</body>
</html>
